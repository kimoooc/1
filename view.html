<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل الكتاب</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            color: #333;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .container {
            display: flex;
            flex-direction: row;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
        }

        .book-cover {
            flex: 0 0 300px;
            max-width: 300px;
        }

        .book-cover img {
            width: 100%;
            border-radius: 8px;
        }

        .book-info {
            flex: 1;
            padding-right: 20px;
        }

        .book-info h1 {
            margin: 0;
            font-size: 24px;
        }

        .book-info table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .book-info table td {
            padding: 5px;
            vertical-align: top;
        }

        .book-info table td:first-child {
            font-weight: bold;
        }

        .book-info table td:nth-child(2) {
            background-color: #ff0;
            padding: 5px;
            border-radius: 5px;
        }

        .details-row {
            display: flex;
            justify-content: space-between;
            text-align: right;
            flex-wrap: wrap;
            margin: 0;
            width: 80%;
        }

        .details-row div {
            flex: 1;
            padding: 0;
            margin: 0;
            border-radius: 5px;
            box-sizing: border-box;
            white-space: nowrap;
        }

        .summary, .review {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .summary h2, .review h2 {
            margin-top: 0;
        }

        .quotes {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .quotes h2 {
            margin-top: 0;
        }

        .quote {
            background-color: #e0e0e0;
            color: #000;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .rating {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .rating h2 {
            margin-top: 0;
        }

        .stars {
            font-size: 32px;
            color: #FFD700;
            text-align: center;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        .rating-stars span {
            font-size: 32px;
            cursor: pointer;
        }

        button {
            background-color: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
        }

        button:hover {
            background-color: #555;
        }

        @media screen and (max-width: 600px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            .book-cover {
                margin-bottom: 20px;
                max-width: 100%;
            }

            .book-info {
                padding-left: 0;
                max-width: 100%;
            }

            .book-info h1 {
                text-align: center;
            }

            .details-row {
                flex-direction: column;
            }

            .details-row div {
                margin: 5px 0;
            }
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .loading-spinner img {
            width: 100px;
        }

        .star-rating, .thank-you, .loading-message {
            display: none;
        }

        .visible {
            display: block;
        }

        .star-rating {
            direction: rtl;
            display: inline-block;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            color: #ccc;
            font-size: 2em;
            padding: 0;
            cursor: pointer;
        }

        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: orange;
        }

        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0, 0, 0, 0.4); 
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%; 
            max-width: 400px;
            text-align: center;
            border-radius: 10px;
            background-color: white;
            color: black;
            font-size: 1.2em;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .checkmark {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #fff;
            stroke-miterlimit: 10;
            margin: 10% auto;
            box-shadow: inset 0px 0px 0px #7ac142;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }

        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #ffffff;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.6s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #7ac142;
            }
        }

        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="book-info">
        <h1 id="book-title"></h1>
        <table id="book-details">
            <tr>
                <td>المؤلف</td>
                <td id="author"></td>
            </tr>
            <tr>
                <td>السعر</td>
                <td id="price"></td>
            </tr>
            <tr>
                <td>تصنيفات</td>
                <td id="categories"></td>
            </tr>
        </table>
    </div>
</div>

<div class="rating">
    <h2>قيم هذا الكتاب</h2>
    <div class="star-rating">
        <input type="radio" id="star5" name="rating" value="5"><label for="star5" title="ممتاز"></label>
        <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="جيد جدًا"></label>
        <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="متوسط"></label>
        <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="سيء"></label>
        <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="سيء جدًا"></label>
    </div>
    <button onclick="submitRating()">إرسال التقييم</button>
</div>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="checkmark">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
        </div>
        <h2>تم إرسال التقييم بنجاح!</h2>
    </div>
</div>

<script>
    // Replace with your Google Apps Script URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxRpo1siczeJVe3g65KXYq1g0xq5O1jUIF7Vr8KrJ7sGZZGw7pr_y9DJC9-_tKvLd96VQ/exec";

    // Function to fetch book details from Google Sheets based on book title
    async function fetchBookDetails(bookTitle) {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/1lVbvdEOsFkL9-agAS_EuS2mZn8Wd343Gw8uc8Pe4Bto/values/Data!A1:L1000?key=AIzaSyBhiqVypmyLHYPmqZYtvdSvxEopcLZBdYU`;
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Failed to fetch book details');
            }
            const data = await response.json();
            document.getElementById('book-title').textContent = data.title;
            document.getElementById('author').textContent = data.author;
            document.getElementById('price').textContent = data.price;
            document.getElementById('categories').textContent = data.categories.join(', ');
            document.querySelector('.container').style.display = 'flex';
        } catch (error) {
            console.error('Error fetching book details:', error);
        }
    }

    // Function to submit rating to Google Apps Script
    async function submitRating() {
        const rating = document.querySelector('input[name="rating"]:checked');
        if (!rating) {
            alert('الرجاء تحديد تقييم!');
            return;
        }

        const bookTitle = document.getElementById('book-title').textContent;
        const formData = new FormData();
        formData.append('rating', rating.value);
        formData.append('bookTitle', bookTitle);

        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });
            if (!response.ok) {
                throw new Error('Failed to submit rating');
            }

            // Show success message and hide rating section
            document.getElementById('myModal').style.display = "block";
            document.querySelector('.rating').style.display = 'none';
        } catch (error) {
            console.error('Error submitting rating:', error);
            alert('حدث خطأ أثناء إرسال التقييم. يرجى المحاولة مرة أخرى.');
        }
    }

    // Close the modal when the user clicks on (x)
    document.querySelector('.close').addEventListener('click', function () {
        document.getElementById('myModal').style.display = "none";
    });

    // Close the modal when the user clicks anywhere outside of the modal
    window.onclick = function (event) {
        const modal = document.getElementById('myModal');
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
</script>

</body>
</html>
